<# 
	.SYNOPSIS 
		Reset the SCOM agent cache. 
	
	.DESCRIPTION 
        This script is used when resolving SCOM grey agent issue. This script is meant for one-off execution as it is written to be run locally. Proces
        stops the SCOM service, deletes the health service state folder and restarts the SCOM service. 	

	.EXAMPLE
		\\clvprdsys001\server_build\scripts\reset-scomagent.ps1
	
	.NOTES
        07.11.2016 JJK: TODO add error detection

	.AUTHOR
		John J Kavanagh
 #>
stop-service healthservice
$healthfldr = 'C:\Program Files\Microsoft Monitoring Agent\agent\Health Service State'
if (test-path $healthfldr ){
    "Removing SCOM Agent Cache"
    remove-item $healthfldr -Confirm:$false -Force -Recurse
}
Else {
    "SCOM Health folder not found"
}
start-service healthservice

# SIG # Begin signature block
# MIITlAYJKoZIhvcNAQcCoIIThTCCE4ECAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB
# gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR
# AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQUwr0rvIko4SAV0JZDbTy9iazA
# +Feggg76MIIEFDCCAvygAwIBAgILBAAAAAABL07hUtcwDQYJKoZIhvcNAQEFBQAw
# VzELMAkGA1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNV
# BAsTB1Jvb3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw0xMTA0
# MTMxMDAwMDBaFw0yODAxMjgxMjAwMDBaMFIxCzAJBgNVBAYTAkJFMRkwFwYDVQQK
# ExBHbG9iYWxTaWduIG52LXNhMSgwJgYDVQQDEx9HbG9iYWxTaWduIFRpbWVzdGFt
# cGluZyBDQSAtIEcyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlO9l
# +LVXn6BTDTQG6wkft0cYasvwW+T/J6U00feJGr+esc0SQW5m1IGghYtkWkYvmaCN
# d7HivFzdItdqZ9C76Mp03otPDbBS5ZBb60cO8eefnAuQZT4XljBFcm05oRc2yrmg
# jBtPCBn2gTGtYRakYua0QJ7D/PuV9vu1LpWBmODvxevYAll4d/eq41JrUJEpxfz3
# zZNl0mBhIvIG+zLdFlH6Dv2KMPAXCae78wSuq5DnbN96qfTvxGInX2+ZbTh0qhGL
# 2t/HFEzphbLswn1KJo/nVrqm4M+SU4B09APsaLJgvIQgAIMboe60dAXBKY5i0Eex
# +vBTzBj5Ljv5cH60JQIDAQABo4HlMIHiMA4GA1UdDwEB/wQEAwIBBjASBgNVHRMB
# Af8ECDAGAQH/AgEAMB0GA1UdDgQWBBRG2D7/3OO+/4Pm9IWbsN1q1hSpwTBHBgNV
# HSAEQDA+MDwGBFUdIAAwNDAyBggrBgEFBQcCARYmaHR0cHM6Ly93d3cuZ2xvYmFs
# c2lnbi5jb20vcmVwb3NpdG9yeS8wMwYDVR0fBCwwKjAooCagJIYiaHR0cDovL2Ny
# bC5nbG9iYWxzaWduLm5ldC9yb290LmNybDAfBgNVHSMEGDAWgBRge2YaRQ2XyolQ
# L30EzTSo//z9SzANBgkqhkiG9w0BAQUFAAOCAQEATl5WkB5GtNlJMfO7FzkoG8IW
# 3f1B3AkFBJtvsqKa1pkuQJkAVbXqP6UgdtOGNNQXzFU6x4Lu76i6vNgGnxVQ380W
# e1I6AtcZGv2v8Hhc4EvFGN86JB7arLipWAQCBzDbsBJe/jG+8ARI9PBw+DpeVoPP
# PfsNvPTF7ZedudTbpSeE4zibi6c1hkQgpDttpGoLoYP9KOva7yj2zIhd+wo7AKvg
# IeviLzVsD440RZfroveZMzV+y5qKu0VN5z+fwtmK+mWybsd+Zf/okuEsMaL3sCc2
# SI8mbzvuTXYfecPlf5Y1vC0OzAGwjn//UYCAp5LUs0RGZIyHTxZjBzFLY7Df8zCC
# BJ8wggOHoAMCAQICEhEh1pmnZJc+8fhCfukZzFNBFDANBgkqhkiG9w0BAQUFADBS
# MQswCQYDVQQGEwJCRTEZMBcGA1UEChMQR2xvYmFsU2lnbiBudi1zYTEoMCYGA1UE
# AxMfR2xvYmFsU2lnbiBUaW1lc3RhbXBpbmcgQ0EgLSBHMjAeFw0xNjA1MjQwMDAw
# MDBaFw0yNzA2MjQwMDAwMDBaMGAxCzAJBgNVBAYTAlNHMR8wHQYDVQQKExZHTU8g
# R2xvYmFsU2lnbiBQdGUgTHRkMTAwLgYDVQQDEydHbG9iYWxTaWduIFRTQSBmb3Ig
# TVMgQXV0aGVudGljb2RlIC0gRzIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
# AoIBAQCwF66i07YEMFYeWA+x7VWk1lTL2PZzOuxdXqsl/Tal+oTDYUDFRrVZUjtC
# oi5fE2IQqVvmc9aSJbF9I+MGs4c6DkPw1wCJU6IRMVIobl1AcjzyCXenSZKX1GyQ
# oHan/bjcs53yB2AsT1iYAGvTFVTg+t3/gCxfGKaY/9Sr7KFFWbIub2Jd4NkZrItX
# nKgmK9kXpRDSRwgacCwzi39ogCq1oV1r3Y0CAikDqnw3u7spTj1Tk7Om+o/SWJMV
# TLktq4CjoyX7r/cIZLB6RA9cENdfYTeqTmvT0lMlnYJz+iz5crCpGTkqUPqp0Dw6
# yuhb7/VfUfT5CtmXNd5qheYjBEKvAgMBAAGjggFfMIIBWzAOBgNVHQ8BAf8EBAMC
# B4AwTAYDVR0gBEUwQzBBBgkrBgEEAaAyAR4wNDAyBggrBgEFBQcCARYmaHR0cHM6
# Ly93d3cuZ2xvYmFsc2lnbi5jb20vcmVwb3NpdG9yeS8wCQYDVR0TBAIwADAWBgNV
# HSUBAf8EDDAKBggrBgEFBQcDCDBCBgNVHR8EOzA5MDegNaAzhjFodHRwOi8vY3Js
# Lmdsb2JhbHNpZ24uY29tL2dzL2dzdGltZXN0YW1waW5nZzIuY3JsMFQGCCsGAQUF
# BwEBBEgwRjBEBggrBgEFBQcwAoY4aHR0cDovL3NlY3VyZS5nbG9iYWxzaWduLmNv
# bS9jYWNlcnQvZ3N0aW1lc3RhbXBpbmdnMi5jcnQwHQYDVR0OBBYEFNSihEo4Whh/
# uk8wUL2d1XqH1gn3MB8GA1UdIwQYMBaAFEbYPv/c477/g+b0hZuw3WrWFKnBMA0G
# CSqGSIb3DQEBBQUAA4IBAQCPqRqRbQSmNyAOg5beI9Nrbh9u3WQ9aCEitfhHNmmO
# 4aVFxySiIrcpCcxUWq7GvM1jjrM9UEjltMyuzZKNniiLE0oRqr2j79OyNvy0oXK/
# bZdjeYxEvHAvfvO83YJTqxr26/ocl7y2N5ykHDC8q7wtRzbfkiAD6HHGWPZ1BZo0
# 8AtZWoJENKqA5C+E9kddlsm2ysqdt6a65FDT1De4uiAO0NOSKlvEWbuhbds8zkSd
# wTgqreONvc0JdxoQvmcKAjZkiLmzGybu555gxEaovGEzbM9OuZy5avCfN/61PU+a
# 003/3iCOTpem/Z8JvE3KGHbJsE2FUPKA0h0G9VgEB7EYMIIGOzCCBSOgAwIBAgIT
# EgAAU2OaMfGo4gCYsQAAAABTYzANBgkqhkiG9w0BAQsFADBFMRMwEQYKCZImiZPy
# LGQBGRYDQ09NMRgwFgYKCZImiZPyLGQBGRYIQ0dJQ0xFVkUxFDASBgNVBAMTC0lz
# c3VpbmdDQTAyMB4XDTE2MDMxNjEyMDUwM1oXDTE4MDMxNjEyMDUwM1owGTEXMBUG
# A1UEAxMOS2F2YW5hZ2gsIEpvaG4wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGB
# AJGswqnSeUgJAOWiY7Iy/nZ+gTwyW2uXhs4s0mNCdOv07TrZdXzyE4NHjw8mj20V
# 14CwlbjXJRKmy4XtoIsqGNuiZqB55CJ8MjFVA1BGQRviBvX6UQknfc6P3tkK/OTw
# XojohrFPexeXXPgUEnBH4HXTmSHciC1Aal7pim+PGykTAgMBAAGjggPSMIIDzjA7
# BgkrBgEEAYI3FQcELjAsBiQrBgEEAYI3FQj89A+CkclMgtWPCYLsoRGHmP4xV4H2
# 0RjEqSMCAWQCAQMwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMEMAsGA1Ud
# DwQEAwIGwDAnBgkrBgEEAYI3FQoEGjAYMAoGCCsGAQUFBwMCMAoGCCsGAQUFBwME
# MB0GA1UdDgQWBBQkGuQFsR/aL2IYvR1LKE5t6lSI9TAfBgNVHSMEGDAWgBRjkhe1
# 92D0uIBh0KOdyx5OJXirpzCCAQYGA1UdHwSB/jCB+zCB+KCB9aCB8oaBu2xkYXA6
# Ly8vQ049SXNzdWluZ0NBMDIsQ049Q2x2UHJkVlNJc0NBMDAyLENOPUNEUCxDTj1Q
# dWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0
# aW9uLERDPUNHSUNMRVZFLERDPUNPTT9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0
# P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0aW9uUG9pbnSGMmh0dHA6Ly9w
# a2kuY2dpY2xldmUuY29tL2NlcnRlbnJvbGwvSXNzdWluZ0NBMDIuY3JsMIIBvAYI
# KwYBBQUHAQEEggGuMIIBqjCBqwYIKwYBBQUHMAKGgZ5sZGFwOi8vL0NOPUlzc3Vp
# bmdDQTAyLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2
# aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPUNHSUNMRVZFLERDPUNPTT9jQUNlcnRp
# ZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1dGhvcml0eTBn
# BggrBgEFBQcwAoZbaHR0cDovL0NsdlByZFZTSXNDQTAwMi5DR0lDTEVWRS5DT00v
# Q2VydEVucm9sbC9DbHZQcmRWU0lzQ0EwMDIuQ0dJQ0xFVkUuQ09NX0lzc3VpbmdD
# QTAyLmNydDBbBggrBgEFBQcwAoZPaHR0cDovL3BraS5jZ2ljbGV2ZS5jb20vY2Vy
# dGVucm9sbC9DbHZQcmRWU0lzQ0EwMDIuQ0dJQ0xFVkUuQ09NX0lzc3VpbmdDQTAy
# LmNydDA0BggrBgEFBQcwAYYoaHR0cDovL0NsdlByZFZTSXNDQTAwMi5DR0lDTEVW
# RS5DT00vb2NzcDAwBgNVHREEKTAnoCUGCisGAQQBgjcUAgOgFwwVamthdmFuYWdA
# Q0dJQ0xFVkUuQ09NMA0GCSqGSIb3DQEBCwUAA4IBAQCUk2v+kxV9FQzelpyEjS+p
# NCfyjCZA/JEJWBNI7Xwp2JRtLpAhUu0EJaioJmtyFU5FZpeurbIDEGCR9PYabFFt
# Lz32HaCVORG3sqdMKj++zX9sL5+ceIf0Ii8dVHb0noAVdqbmyYk2Ko1gXLeltL4o
# JOe33yVYYUsLSp5dcKZ1vaOs2bkcTjVCiXmBcbtsRthmTuo58gUkZQMdBsRLfKuD
# yo2oM3w1Ix+LjSiCcFEGmxGSui4m6IK80A2e2jvcfeUZv/jZ1EopPYTSyuFY9TgQ
# SO0zjiP2io++QambRBLpKqC7T/1oaIqY9XUQtsH+9uwclHwn8jTeUFWOjdkvu10y
# MYIEBDCCBAACAQEwXDBFMRMwEQYKCZImiZPyLGQBGRYDQ09NMRgwFgYKCZImiZPy
# LGQBGRYIQ0dJQ0xFVkUxFDASBgNVBAMTC0lzc3VpbmdDQTAyAhMSAABTY5ox8aji
# AJixAAAAAFNjMAkGBSsOAwIaBQCgWjAYBgorBgEEAYI3AgEMMQowCKACgAChAoAA
# MBkGCSqGSIb3DQEJAzEMBgorBgEEAYI3AgEEMCMGCSqGSIb3DQEJBDEWBBSrbeJx
# PyouENk25ZREWvccBV1E/jANBgkqhkiG9w0BAQEFAASBgFM7ZKPipKvAA7FAy25L
# xr8H54FtqcBmsVXYgcb9eiSH4KRihxj6mJTC9kFajhlNDed3hZFL0nRVBvwsK7ZW
# GoOJyOfbo/EH6nyBET+L1wdICp2B86dhPHgXwFegUJCXMHepWr2Pfw8uWe17ZxWT
# GyVy2Tor3mHVWlI2snCxePkToYICojCCAp4GCSqGSIb3DQEJBjGCAo8wggKLAgEB
# MGgwUjELMAkGA1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExKDAm
# BgNVBAMTH0dsb2JhbFNpZ24gVGltZXN0YW1waW5nIENBIC0gRzICEhEh1pmnZJc+
# 8fhCfukZzFNBFDAJBgUrDgMCGgUAoIH9MBgGCSqGSIb3DQEJAzELBgkqhkiG9w0B
# BwEwHAYJKoZIhvcNAQkFMQ8XDTE2MDcyMDEzMjI1NVowIwYJKoZIhvcNAQkEMRYE
# FMUBLv50HuBQL2RthSxXSlb3XiuYMIGdBgsqhkiG9w0BCRACDDGBjTCBijCBhzCB
# hAQUY7gvq2H1g5CWlQULACScUCkz7HkwbDBWpFQwUjELMAkGA1UEBhMCQkUxGTAX
# BgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExKDAmBgNVBAMTH0dsb2JhbFNpZ24gVGlt
# ZXN0YW1waW5nIENBIC0gRzICEhEh1pmnZJc+8fhCfukZzFNBFDANBgkqhkiG9w0B
# AQEFAASCAQCPCgLjX8Byfi5JB6HFqiC/yNYS19+XmaEtgiBsjxXENh3ZulDHqDjn
# AHujW4flZGjaQL3DObAXm8fDJ9jhRdHJ1hV3+2AWHq7etci1ywH3m6xzVj1M13pB
# Xi5JwYpG6ImNAAd0+FbrKjIqc4xWPPsHe/cp4XdsZvqoxNmuPIUF3qk76tbBRcnv
# XKMiuhN+dI8Gh/n28i5lvQxzxLFIg6XWBRg3hAy09urFTW5bGbO6Utffa9NU8QbL
# hYTOMgzf7p/0efWicSOFH5FM8CbP1n2/UMqopUGmgjpeECsn62/UdCn/PAaQa6Jf
# jN2Nt1u0BE51CoBNrMRUeaCo8uaQqeUk
# SIG # End signature block
